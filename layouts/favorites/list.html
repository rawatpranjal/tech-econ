{{ define "main" }}
<!-- All Data for Favorites Lookup -->
<script id="all-data" type="application/json">
{
  "resource": {{ .Site.Data.resources | jsonify | safeJS }},
  "package": {{ .Site.Data.packages | jsonify | safeJS }},
  "dataset": {{ .Site.Data.datasets | jsonify | safeJS }},
  "talk": {{ .Site.Data.talks | jsonify | safeJS }},
  "book": {{ .Site.Data.books | jsonify | safeJS }},
  "career": {{ .Site.Data.career | jsonify | safeJS }},
  "community": {{ .Site.Data.community | jsonify | safeJS }},
  "paper": {{ .Site.Data.papers | jsonify | safeJS }},
  "roadmap": {{ .Site.Data.roadmaps | jsonify | safeJS }}
}
</script>

<header class="hero hero-with-image hero-favorites">
    <h1 class="hero-title">My Collection</h1>
    <p class="hero-tagline">Your saved resources organized by playlist</p>
</header>

<div class="page-container">
    <!-- Storage Warning Banner -->
    <div class="storage-warning">
        <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="12"></line>
            <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <span>Your collection is saved in your browser. Use <strong>Export</strong> to backup your data.</span>
    </div>

    <!-- Collection Container -->
    <div id="collection-container" class="collection-container">
        <div class="loading">Loading...</div>
    </div>
</div>

<!-- Create Playlist Modal -->
<div id="create-playlist-modal" class="modal" style="display: none;">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
        <h3>Create New Playlist</h3>
        <input type="text" id="playlist-name-input" placeholder="Playlist name" class="modal-input" />
        <div class="modal-actions">
            <button class="btn btn-outline" id="cancel-playlist-btn">Cancel</button>
            <button class="btn btn-primary" id="create-playlist-btn">Create</button>
        </div>
    </div>
</div>

<!-- Rename Playlist Modal -->
<div id="rename-playlist-modal" class="modal" style="display: none;">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
        <h3>Rename Playlist</h3>
        <input type="text" id="rename-playlist-input" placeholder="New name" class="modal-input" />
        <input type="hidden" id="rename-playlist-id" />
        <div class="modal-actions">
            <button class="btn btn-outline" id="cancel-rename-btn">Cancel</button>
            <button class="btn btn-primary" id="confirm-rename-btn">Rename</button>
        </div>
    </div>
</div>

<!-- Playlist Detail Modal -->
<div id="playlist-detail-modal" class="modal" style="display: none;">
    <div class="modal-backdrop"></div>
    <div class="modal-content modal-large">
        <div class="modal-header">
            <h3 id="playlist-detail-title">Playlist Name</h3>
            <button class="modal-close" id="close-playlist-detail">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div id="playlist-detail-items" class="playlist-items">
            <!-- Items rendered here -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" id="export-playlist-btn">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Export CSV
            </button>
        </div>
    </div>
</div>

<!-- Add to Playlist Modal -->
<div id="add-to-playlist-modal" class="modal" style="display: none;">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h3>Add to Playlist</h3>
            <button class="modal-close" id="close-add-playlist-modal">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div id="playlist-options" class="playlist-options-list">
            <!-- Playlist options rendered here -->
        </div>
        <div class="modal-actions">
            <button class="btn btn-outline" id="create-and-add-btn">
                <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Create New Playlist
            </button>
        </div>
    </div>
</div>

<!-- Hidden file input for CSV import -->
<input type="file" id="csv-import-input" accept=".csv" style="display: none;" />

<style>
.page-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem;
}

.collection-container {
    min-height: 300px;
}
</style>

<!-- Fallback if JS fails to load -->
<script>
setTimeout(function() {
    var container = document.getElementById('collection-container');
    if (container && container.innerHTML.indexOf('Loading') !== -1) {
        console.error('[Collection] Fallback triggered - JS did not load');
        container.innerHTML = '<div class="error" style="padding: 2rem; text-align: center;">' +
            '<p>Failed to load collection. Check browser console (F12) for errors.</p>' +
            '<p style="margin-top: 1rem;"><a href="javascript:location.reload()">Refresh Page</a></p>' +
            '</div>';
    }
}, 5000);
</script>
{{ end }}
