{{ define "main" }}
<!-- Hero Section -->
<header class="hero hero-with-image hero-talks">
    <h1 class="hero-title">Talks</h1>
    <p class="hero-tagline">Videos, podcasts, blogs, and books for tech economists.</p>
</header>

{{/* Count items for each tab */}}
{{ $videos := where .Site.Data.talks "type" "in" (slice "Video" "YouTube Channel" "Interview" "Video Series" "Talks + Papers") }}
{{ $podcasts := where .Site.Data.talks "type" "in" (slice "Podcast" "Podcast Series") }}
{{ $blogs := where .Site.Data.community "category" "Blogs" }}
{{ $industryBlogsFromResources := where .Site.Data.resources "category" "Industry Blogs" }}
{{ $books := .Site.Data.books }}

<div class="container">
    <!-- Main Tabs -->
    <div class="main-tabs">
        <button class="main-tab active" data-tab="videos">
            Videos <span class="tab-count">{{ len $videos }}</span>
        </button>
        <button class="main-tab" data-tab="podcasts">
            Podcasts <span class="tab-count">{{ len $podcasts }}</span>
        </button>
        <button class="main-tab" data-tab="blogs">
            Blogs <span class="tab-count">{{ add (len $blogs) (len $industryBlogsFromResources) }}</span>
        </button>
        <button class="main-tab" data-tab="books">
            Books <span class="tab-count">{{ len $books }}</span>
        </button>
    </div>

    <!-- ========== VIDEOS TAB ========== -->
    <div id="tab-videos" class="tab-content active">
        {{ $videoCategories := slice }}
        {{ range $videos }}
            {{ if not (in $videoCategories .category) }}
                {{ $videoCategories = $videoCategories | append .category }}
            {{ end }}
        {{ end }}

        <div class="search-filters-row">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <svg class="search-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="videos-search" class="search-input" placeholder="Search videos..." autocomplete="off">
                </div>
            </div>
            <select id="videos-category" class="category-select">
                <option value="all">All Topics</option>
                {{ range $cat := sort $videoCategories }}
                <option value="{{ $cat }}">{{ $cat }}</option>
                {{ end }}
            </select>
        </div>

        <div id="videos-count" class="result-count">{{ len $videos }} videos</div>

        <div class="resources-grid">
            {{ range $cat := $videoCategories }}
            <div class="category-section" data-section-category="{{ $cat }}">
                <h2 class="category-title">{{ $cat }}</h2>
                <div class="cards-row">
                    {{ range $videos }}
                    {{ if eq .category $cat }}
                    <div class="resource-card" data-name="{{ .name | lower }}" data-description="{{ .description | lower }}" data-category="{{ .category }}">
                        {{ if .image_url }}
                        <a href="{{ .url }}" target="_blank" class="talk-thumbnail-link">
                            <img src="{{ .image_url }}" alt="" class="talk-thumbnail" loading="lazy">
                        </a>
                        {{ else if findRE "youtube\\.com/@|youtube\\.com/c/|youtube\\.com/channel/" .url }}
                        <a href="{{ .url }}" target="_blank" class="talk-thumbnail-link talk-thumbnail-yt-channel">
                            <div class="yt-channel-placeholder">
                                <svg viewBox="0 0 24 24" width="48" height="48" fill="white">
                                    <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                                </svg>
                            </div>
                        </a>
                        {{ else if findRE "youtube\\.com|youtu\\.be" .url }}
                        {{ $videoId := replaceRE ".*(?:v=|youtu\\.be/)([^&?]+).*" "$1" .url }}
                        <a href="{{ .url }}" target="_blank" class="talk-thumbnail-link">
                            <img src="https://img.youtube.com/vi/{{ $videoId }}/mqdefault.jpg" alt="" class="talk-thumbnail" loading="lazy">
                            <div class="play-overlay">
                                <svg viewBox="0 0 24 24" width="48" height="48" fill="white">
                                    <polygon points="5,3 19,12 5,21"></polygon>
                                </svg>
                            </div>
                        </a>
                        {{ end }}
                        <div class="card-header">
                            <img class="resource-favicon" src="https://www.google.com/s2/favicons?domain={{ .url | replaceRE "^https?://([^/]+).*" "$1" }}&sz=32" alt="" loading="lazy" onerror="this.style.display='none'">
                            <h3 class="resource-name">
                                <a href="{{ .url }}" target="_blank" rel="noopener">{{ .name }}</a>
                            </h3>
                            <span class="resource-type">{{ .type }}</span>
                        </div>
                        <p class="resource-desc">{{ .description }}</p>
                        <div class="card-footer">
                            <span class="category-badge">{{ .category }}</span>
                            <a href="{{ .url }}" target="_blank" class="link-btn">Watch</a>
                        </div>
                    </div>
                    {{ end }}
                    {{ end }}
                </div>
            </div>
            {{ end }}
        </div>
    </div>

    <!-- ========== PODCASTS TAB ========== -->
    <div id="tab-podcasts" class="tab-content">
        {{ $podcastCategories := slice }}
        {{ range $podcasts }}
            {{ if not (in $podcastCategories .category) }}
                {{ $podcastCategories = $podcastCategories | append .category }}
            {{ end }}
        {{ end }}

        <div class="search-filters-row">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <svg class="search-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="podcasts-search" class="search-input" placeholder="Search podcasts..." autocomplete="off">
                </div>
            </div>
            <select id="podcasts-category" class="category-select">
                <option value="all">All Topics</option>
                {{ range $cat := sort $podcastCategories }}
                <option value="{{ $cat }}">{{ $cat }}</option>
                {{ end }}
            </select>
        </div>

        <div id="podcasts-count" class="result-count">{{ len $podcasts }} podcasts</div>

        <div class="resources-grid">
            {{ range $cat := $podcastCategories }}
            <div class="category-section" data-section-category="{{ $cat }}">
                <h2 class="category-title">{{ $cat }}</h2>
                <div class="cards-row">
                    {{ range $podcasts }}
                    {{ if eq .category $cat }}
                    <div class="resource-card" data-name="{{ .name | lower }}" data-description="{{ .description | lower }}" data-category="{{ .category }}">
                        <div class="card-header">
                            <img class="resource-favicon" src="https://www.google.com/s2/favicons?domain={{ .url | replaceRE "^https?://([^/]+).*" "$1" }}&sz=32" alt="" loading="lazy" onerror="this.style.display='none'">
                            <h3 class="resource-name">
                                <a href="{{ .url }}" target="_blank" rel="noopener">{{ .name }}</a>
                            </h3>
                            <span class="resource-type">{{ .type }}</span>
                        </div>
                        <p class="resource-desc">{{ .description }}</p>
                        <div class="card-footer">
                            <span class="category-badge">{{ .category }}</span>
                            <a href="{{ .url }}" target="_blank" class="link-btn">Listen</a>
                        </div>
                    </div>
                    {{ end }}
                    {{ end }}
                </div>
            </div>
            {{ end }}
        </div>
    </div>

    <!-- ========== BLOGS TAB ========== -->
    <div id="tab-blogs" class="tab-content">
        <div class="search-filters-row">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <svg class="search-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="blogs-search" class="search-input" placeholder="Search blogs..." autocomplete="off">
                </div>
            </div>
            <select id="blogs-category" class="category-select">
                <option value="all">All Blogs</option>
                <option value="Personal">Personal Blogs</option>
                <option value="Industry">Industry Blogs</option>
            </select>
        </div>

        <div id="blogs-count" class="result-count">{{ add (len $blogs) (len $industryBlogsFromResources) }} blogs</div>

        <div class="resources-grid">
            <div class="category-section" data-section-category="Personal">
                <h2 class="category-title">Personal Blogs</h2>
                <div class="cards-row">
                    {{ range $blogs }}
                    <div class="resource-card" data-name="{{ .name | lower }}" data-description="{{ .description | lower }}" data-category="Personal">
                        <div class="card-header">
                            <img class="resource-favicon" src="https://www.google.com/s2/favicons?domain={{ .url | replaceRE "^https?://([^/]+).*" "$1" }}&sz=32" alt="" loading="lazy" onerror="this.style.display='none'">
                            <h3 class="resource-name">
                                <a href="{{ .url }}" target="_blank" rel="noopener">{{ .name }}</a>
                            </h3>
                        </div>
                        <p class="resource-desc">{{ .description }}</p>
                        <div class="card-footer">
                            <span class="category-badge">Personal</span>
                            <a href="{{ .url }}" target="_blank" class="link-btn">Read</a>
                        </div>
                    </div>
                    {{ end }}
                </div>
            </div>
            <div class="category-section" data-section-category="Industry">
                <h2 class="category-title">Industry Blogs</h2>
                <div class="cards-row">
                    {{ range $industryBlogsFromResources }}
                    <div class="resource-card" data-name="{{ .name | lower }}" data-description="{{ .description | lower }}" data-category="Industry">
                        <div class="card-header">
                            <img class="resource-favicon" src="https://www.google.com/s2/favicons?domain={{ .url | replaceRE "^https?://([^/]+).*" "$1" }}&sz=32" alt="" loading="lazy" onerror="this.style.display='none'">
                            <h3 class="resource-name">
                                <a href="{{ .url }}" target="_blank" rel="noopener">{{ .name }}</a>
                            </h3>
                        </div>
                        <p class="resource-desc">{{ .description }}</p>
                        <div class="card-footer">
                            <span class="category-badge">Industry</span>
                            <a href="{{ .url }}" target="_blank" class="link-btn">Read</a>
                        </div>
                    </div>
                    {{ end }}
                </div>
            </div>
        </div>
    </div>

    <!-- ========== BOOKS TAB ========== -->
    <div id="tab-books" class="tab-content">
        {{ $bookCategories := slice }}
        {{ range $books }}
            {{ if not (in $bookCategories .category) }}
                {{ $bookCategories = $bookCategories | append .category }}
            {{ end }}
        {{ end }}

        <div class="search-filters-row">
            <div class="search-container">
                <div class="search-input-wrapper">
                    <svg class="search-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                    <input type="text" id="books-search" class="search-input" placeholder="Search books..." autocomplete="off">
                </div>
            </div>
            <select id="books-category" class="category-select">
                <option value="all">All Topics</option>
                {{ range $cat := sort $bookCategories }}
                <option value="{{ $cat }}">{{ $cat }}</option>
                {{ end }}
            </select>
        </div>

        <div id="books-count" class="result-count">{{ len $books }} books</div>

        <div class="resources-grid">
            {{ range $cat := $bookCategories }}
            <div class="category-section" data-section-category="{{ $cat }}">
                <h2 class="category-title">{{ $cat }}</h2>
                <div class="cards-row">
                    {{ range $books }}
                    {{ if eq .category $cat }}
                    <div class="resource-card" data-name="{{ .name | lower }}" data-description="{{ .description | lower }}" data-category="{{ .category }}">
                        <div class="card-header">
                            <img class="resource-favicon" src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32" alt="" loading="lazy">
                            <h3 class="resource-name">
                                <a href="{{ .url }}" target="_blank" rel="noopener">{{ .name }}</a>
                            </h3>
                            <span class="resource-type">{{ .year }}</span>
                        </div>
                        <p class="resource-author">{{ .author }}</p>
                        <p class="resource-desc">{{ .description }}</p>
                        <div class="card-footer">
                            <span class="category-badge">{{ .category }}</span>
                            <a href="{{ .url }}" target="_blank" class="link-btn">Amazon</a>
                        </div>
                    </div>
                    {{ end }}
                    {{ end }}
                </div>
            </div>
            {{ end }}
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>Curated learning resources for tech economists</p>
    </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const tabs = document.querySelectorAll('.main-tab');
    const tabContents = document.querySelectorAll('.tab-content');

    function switchTab(tabId) {
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(tc => tc.classList.remove('active'));

        document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
        document.getElementById(`tab-${tabId}`).classList.add('active');

        // Update URL hash
        history.replaceState(null, null, `#${tabId}`);
    }

    tabs.forEach(tab => {
        tab.addEventListener('click', () => switchTab(tab.dataset.tab));
    });

    // Handle URL hash on load
    const hash = window.location.hash.slice(1);
    if (hash && document.getElementById(`tab-${hash}`)) {
        switchTab(hash);
    }

    // Simple search and filter for each tab
    function setupTabSearch(searchId, categoryId, countId, itemLabel) {
        const searchInput = document.getElementById(searchId);
        const categorySelect = categoryId ? document.getElementById(categoryId) : null;
        const countEl = document.getElementById(countId);
        const tabContent = searchInput.closest('.tab-content');
        const cards = tabContent.querySelectorAll('.resource-card');
        const sections = tabContent.querySelectorAll('.category-section');

        function filterItems() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedCategory = categorySelect ? categorySelect.value : 'all';
            let visibleCount = 0;

            cards.forEach(card => {
                const name = card.dataset.name || '';
                const desc = card.dataset.description || '';
                const category = card.dataset.category || '';

                const matchesSearch = !searchTerm || name.includes(searchTerm) || desc.includes(searchTerm);
                const matchesCategory = selectedCategory === 'all' || category === selectedCategory;

                if (matchesSearch && matchesCategory) {
                    card.style.display = '';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                }
            });

            // Hide empty sections
            sections.forEach(section => {
                const visibleCards = section.querySelectorAll('.resource-card:not([style*="display: none"])');
                section.style.display = visibleCards.length ? '' : 'none';
            });

            countEl.textContent = `${visibleCount} ${itemLabel}`;
        }

        searchInput.addEventListener('input', filterItems);
        if (categorySelect) {
            categorySelect.addEventListener('change', filterItems);
        }
    }

    setupTabSearch('videos-search', 'videos-category', 'videos-count', 'videos');
    setupTabSearch('podcasts-search', 'podcasts-category', 'podcasts-count', 'podcasts');
    setupTabSearch('blogs-search', 'blogs-category', 'blogs-count', 'blogs');
    setupTabSearch('books-search', 'books-category', 'books-count', 'books');
});
</script>
{{ end }}
