{{ define "main" }}
<!-- Hero Section -->
<header class="hero hero-with-image hero-papers">
    <h1 class="hero-title">Papers</h1>
    {{ $totalPapers := 0 }}
    {{ $totalSubtopics := 0 }}
    {{ $totalCitations := 0 }}
    {{ range .Site.Data.papers.topics }}
        {{ range .subtopics }}
            {{ $totalSubtopics = add $totalSubtopics 1 }}
            {{ $totalPapers = add $totalPapers (len .papers) }}
            {{ range .papers }}
                {{ if .citations }}{{ $totalCitations = add $totalCitations .citations }}{{ end }}
            {{ end }}
        {{ end }}
    {{ end }}
    <p class="hero-tagline">Curated reading list for tech economists &bull; {{ len .Site.Data.papers.topics }} topics &bull; {{ $totalSubtopics }} subtopics{{ if gt $totalPapers 0 }} &bull; {{ $totalPapers }} papers{{ end }}{{ if gt $totalCitations 0 }} &bull; {{ div $totalCitations 1000 }}K+ citations{{ end }}</p>
</header>

<div class="container">
    <!-- View Toggle -->
    <div class="search-filters-row">
        <div class="result-count">{{ len .Site.Data.papers.topics }} topics</div>
        <div class="view-toggle">
            <button id="btn-cards" class="toggle-btn active">Cards</button>
            <button id="btn-table" class="toggle-btn">Table</button>
        </div>
    </div>

    <!-- Cards View -->
    <div id="cards-view" class="topics-grid">
        {{ range .Site.Data.papers.topics }}
        {{ $topic := . }}
        {{ $paperCount := 0 }}
        {{ range .subtopics }}
            {{ $paperCount = add $paperCount (len .papers) }}
        {{ end }}
        <a href="{{ printf "papers/%s/" .id | relURL }}" class="topic-card" data-aos="fade-up">
            {{ if .image_url }}
            <div class="topic-card-image">
                <img src="{{ .image_url }}" alt="{{ .name }}" loading="lazy">
            </div>
            {{ end }}
            <div class="topic-card-content">
                <h3 class="topic-name">{{ .name }}</h3>
                <p class="topic-description">{{ .description }}</p>
                <div class="topic-meta">
                    <span class="topic-stat">{{ len .subtopics }} subtopics</span>
                    {{ if gt $paperCount 0 }}
                    <span class="topic-stat">&bull; {{ $paperCount }} papers</span>
                    {{ end }}
                </div>
            </div>
            <div class="topic-arrow">
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"></path>
                </svg>
            </div>
        </a>
        {{ end }}
    </div>

    <!-- Table View -->
    <div id="table-view" class="papers-table-wrapper" style="display: none;">
        <table class="papers-table">
            <thead>
                <tr>
                    <th>Topic</th>
                    <th>Description</th>
                    <th>Subtopics</th>
                    <th>Papers</th>
                </tr>
            </thead>
            <tbody>
                {{ range .Site.Data.papers.topics }}
                {{ $paperCount := 0 }}
                {{ range .subtopics }}
                    {{ $paperCount = add $paperCount (len .papers) }}
                {{ end }}
                <tr>
                    <td class="topic-name-cell">
                        <a href="{{ printf "papers/%s/" .id | relURL }}">{{ .name }}</a>
                    </td>
                    <td class="topic-desc-cell">{{ .description }}</td>
                    <td class="topic-count-cell">{{ len .subtopics }}</td>
                    <td class="topic-count-cell">{{ $paperCount }}</td>
                </tr>
                {{ end }}
            </tbody>
        </table>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>Must-read papers for tech economists and applied researchers</p>
    </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const btnCards = document.getElementById('btn-cards');
    const btnTable = document.getElementById('btn-table');
    const cardsView = document.getElementById('cards-view');
    const tableView = document.getElementById('table-view');

    if (!btnCards || !btnTable || !cardsView || !tableView) return;

    let savedView = 'cards';
    try { savedView = localStorage.getItem('papersTopicView') || 'cards'; } catch(e) {}

    function setView(view) {
        const isCards = view === 'cards';
        cardsView.style.display = isCards ? '' : 'none';
        tableView.style.display = isCards ? 'none' : '';
        btnCards.classList.toggle('active', isCards);
        btnTable.classList.toggle('active', !isCards);
    }

    btnCards.addEventListener('click', function() {
        setView('cards');
        try { localStorage.setItem('papersTopicView', 'cards'); } catch(e) {}
    });

    btnTable.addEventListener('click', function() {
        setView('table');
        try { localStorage.setItem('papersTopicView', 'table'); } catch(e) {}
    });

    if (savedView === 'table') setView('table');
});
</script>
{{ end }}
