{{ define "main" }}
<!-- Hero Section -->
<header class="hero hero-with-image hero-career">
    <h1 class="hero-title">Career</h1>
    {{ $activeCount := 0 }}
    {{ range .Site.Data.career }}{{ if not .archived }}{{ $activeCount = add $activeCount 1 }}{{ end }}{{ end }}
    <p class="hero-tagline">{{ $activeCount }} curated resources for your PhD to Tech journey.</p>
</header>

<div class="container">
    <!-- Search Bar -->
    <div class="search-filters-row">
        <div class="search-container">
            <div class="search-input-wrapper">
                <svg class="search-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text" id="career-search" class="search-input" placeholder="Search career resources..." autocomplete="off">
                <button id="clear-search" class="clear-btn" type="button" aria-label="Clear search">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Main Tabs -->
    <div class="career-tabs">
        <button class="career-tab active" data-tab="strategy">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <polygon points="16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76"></polygon>
            </svg>
            Strategy & Discovery
        </button>
        <button class="career-tab" data-tab="interview">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="6"></circle>
                <circle cx="12" cy="12" r="2"></circle>
            </svg>
            Interview Prep
        </button>
    </div>

    <!-- Tab 1: Strategy & Discovery -->
    <div id="tab-strategy" class="career-tab-content active">

        <!-- Essential Reading Section -->
        <section class="curated-section essential-section">
            <div class="section-header">
                <h2>Start Here: Essential Reading</h2>
                <p>New to tech careers for economists? Begin with these foundational resources.</p>
            </div>
            <ol class="essential-list">
                {{ $num := 0 }}
                {{ range .Site.Data.career }}
                {{ if and (eq .section "essential") (not .archived) }}
                {{ $num = add $num 1 }}
                <li class="essential-item">
                    <span class="essential-number">{{ $num }}</span>
                    <div class="essential-content">
                        <div class="essential-header">
                            <img class="favicon" src="https://www.google.com/s2/favicons?domain={{ .url | replaceRE "^https?://([^/]+).*" "$1" }}&sz=32" alt="" loading="lazy" onerror="this.style.display='none'">
                            <a href="{{ .url }}" target="_blank" rel="noopener" class="essential-name">{{ .name }}</a>
                            <span class="type-badge">{{ .type }}</span>
                        </div>
                        <p class="essential-desc">{{ .description }}</p>
                    </div>
                </li>
                {{ end }}
                {{ end }}
            </ol>
        </section>

        <!-- Role Sense Section -->
        <section class="curated-section roles-section">
            <div class="section-header">
                <h2>Understanding Roles</h2>
                <p>Learn how DS/Economist roles differ across companies and levels.</p>
            </div>
            <div class="roles-grid">
                {{ range .Site.Data.career }}
                {{ if and (eq .section "roles") (not .archived) }}
                <a href="{{ .url }}" target="_blank" rel="noopener" class="role-card">
                    <img class="favicon" src="https://www.google.com/s2/favicons?domain={{ .url | replaceRE "^https?://([^/]+).*" "$1" }}&sz=32" alt="" loading="lazy" onerror="this.style.display='none'">
                    <span class="role-name">{{ .name }}</span>
                </a>
                {{ end }}
                {{ end }}
            </div>
        </section>

        <!-- Type of Work Section -->
        <section class="curated-section work-section">
            <div class="section-header">
                <h2>What Teams Do</h2>
                <p>One exemplar article per domain to understand different team types.</p>
            </div>
            <div class="work-grid">
                {{ $domains := slice "Pricing" "Experimentation" "Ads" "Trust" "Forecasting" "Recommendations" "Growth" "Economist Teams" }}
                {{ range $domain := $domains }}
                {{ range $.Site.Data.career }}
                {{ if and (eq .section "work") (eq .domain $domain) (not .archived) }}
                <a href="{{ .url }}" target="_blank" rel="noopener" class="work-card">
                    <div class="work-badge">{{ $domain }}</div>
                    <div class="work-content">
                        <img class="favicon" src="https://www.google.com/s2/favicons?domain={{ .url | replaceRE "^https?://([^/]+).*" "$1" }}&sz=32" alt="" loading="lazy" onerror="this.style.display='none'">
                        <span class="work-name">{{ .name }}</span>
                    </div>
                    <p class="work-desc">{{ .description }}</p>
                </a>
                {{ end }}
                {{ end }}
                {{ end }}
            </div>
        </section>

        <!-- Companies by Sector Section -->
        <section class="curated-section companies-section">
            <div class="section-header">
                <h2>Companies Hiring</h2>
                <p>Career portals organized by sector.</p>
            </div>

            <!-- Sector Pills -->
            <div class="sector-pills">
                <button class="sector-pill active" data-sector="all">All</button>
                <button class="sector-pill" data-sector="faang">FAANG+</button>
                <button class="sector-pill" data-sector="marketplace">Marketplaces</button>
                <button class="sector-pill" data-sector="social">Social & Media</button>
                <button class="sector-pill" data-sector="fintech">Fintech</button>
                <button class="sector-pill" data-sector="saas">Enterprise</button>
                <button class="sector-pill" data-sector="pharma">Pharma</button>
                <button class="sector-pill" data-sector="ai-gaming">AI & Gaming</button>
            </div>

            <div class="companies-grid">
                {{ range .Site.Data.career }}
                {{ if and (eq .section "companies") (not .archived) }}
                <a href="{{ .url }}" target="_blank" rel="noopener" class="company-card" data-sector="{{ .sector }}">
                    <img class="favicon" src="https://www.google.com/s2/favicons?domain={{ .url | replaceRE "^https?://([^/]+).*" "$1" }}&sz=32" alt="" loading="lazy" onerror="this.style.display='none'">
                    <span class="company-name">{{ .name }}</span>
                </a>
                {{ end }}
                {{ end }}
            </div>
        </section>

        <!-- Negotiation Section -->
        <section class="curated-section negotiation-section">
            <div class="section-header">
                <h2>Offer Negotiation</h2>
                <p>Resources for evaluating and negotiating offers.</p>
            </div>
            <div class="negotiation-grid">
                {{ range .Site.Data.career }}
                {{ if and (eq .section "negotiation") (not .archived) }}
                <a href="{{ .url }}" target="_blank" rel="noopener" class="negotiation-card">
                    <img class="favicon" src="https://www.google.com/s2/favicons?domain={{ .url | replaceRE "^https?://([^/]+).*" "$1" }}&sz=32" alt="" loading="lazy" onerror="this.style.display='none'">
                    <div class="negotiation-content">
                        <span class="negotiation-name">{{ .name }}</span>
                        <p class="negotiation-desc">{{ .description }}</p>
                    </div>
                </a>
                {{ end }}
                {{ end }}
            </div>
        </section>
    </div>

    <!-- Tab 2: Interview Prep -->
    <div id="tab-interview" class="career-tab-content">
        {{ $interviewCategories := slice "SQL & Data" "Stats & Probability" "Experimentation" "ML Fundamentals" "ML System Design" "Product Sense" "Behavioral" "Take-Home" }}

        {{ range $cat := $interviewCategories }}
        {{ $catCount := 0 }}
        {{ range $.Site.Data.career }}
            {{ if and (eq .section "interview") (eq .category $cat) (not .archived) }}
                {{ $catCount = add $catCount 1 }}
            {{ end }}
        {{ end }}

        {{ if gt $catCount 0 }}
        <section class="interview-category">
            <h3 class="interview-category-title">{{ $cat }} <span class="count">({{ $catCount }})</span></h3>
            <div class="interview-grid">
                {{ range $.Site.Data.career }}
                {{ if and (eq .section "interview") (eq .category $cat) (not .archived) }}
                <a href="{{ .url }}" target="_blank" rel="noopener" class="interview-card">
                    <img class="favicon" src="https://www.google.com/s2/favicons?domain={{ .url | replaceRE "^https?://([^/]+).*" "$1" }}&sz=32" alt="" loading="lazy" onerror="this.style.display='none'">
                    <div class="interview-content">
                        <span class="interview-name">{{ .name }}</span>
                        <p class="interview-desc">{{ .description }}</p>
                    </div>
                    <span class="type-badge">{{ .type }}</span>
                </a>
                {{ end }}
                {{ end }}
            </div>
        </section>
        {{ end }}
        {{ end }}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const tabs = document.querySelectorAll('.career-tab');
    const tabContents = document.querySelectorAll('.career-tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetTab = this.dataset.tab;

            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));

            this.classList.add('active');
            document.getElementById('tab-' + targetTab).classList.add('active');
        });
    });

    // Sector filtering
    const sectorPills = document.querySelectorAll('.sector-pill');
    const companyCards = document.querySelectorAll('.company-card');

    sectorPills.forEach(pill => {
        pill.addEventListener('click', function() {
            const sector = this.dataset.sector;

            sectorPills.forEach(p => p.classList.remove('active'));
            this.classList.add('active');

            companyCards.forEach(card => {
                if (sector === 'all' || card.dataset.sector === sector) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        });
    });

    // Search functionality
    const searchInput = document.getElementById('career-search');
    const clearBtn = document.getElementById('clear-search');

    searchInput.addEventListener('input', function() {
        const query = this.value.toLowerCase();

        // Search in all visible cards across all sections
        document.querySelectorAll('.essential-item, .role-card, .work-card, .company-card, .negotiation-card, .interview-card').forEach(card => {
            const text = card.textContent.toLowerCase();
            if (query === '' || text.includes(query)) {
                card.style.display = '';
            } else {
                card.style.display = 'none';
            }
        });

        clearBtn.style.display = query ? 'flex' : 'none';
    });

    clearBtn.addEventListener('click', function() {
        searchInput.value = '';
        searchInput.dispatchEvent(new Event('input'));
        this.style.display = 'none';
    });
});
</script>
{{ end }}
