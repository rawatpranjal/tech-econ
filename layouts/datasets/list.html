{{ define "main" }}
<!-- Hero Section -->
<header class="hero hero-with-image hero-datasets">
    <h1 class="hero-title">Datasets</h1>
    <p class="hero-tagline">{{ len .Site.Data.datasets }} industry datasets across e-commerce, economics, and ML.</p>
</header>

<!-- Search Index Data for Fuse.js -->
<script id="search-data" type="application/json">
[{{ range $i, $item := .Site.Data.datasets }}{{ if $i }},{{ end }}{"name":"{{ .name }}","description":"{{ .description | htmlEscape }}","category":"{{ .category }}","tags":"{{ delimit .tags "," }}"}{{ end }}]
</script>

<div class="container">
    <!-- Search and Filters Row -->
    <div class="search-filters-row">
        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-input-wrapper">
                <svg class="search-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text"
                       id="dataset-search"
                       class="search-input"
                       placeholder="Search datasets..."
                       autocomplete="off">
                <button id="clear-search" class="clear-btn" type="button" aria-label="Clear search">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Category Dropdown -->
        {{ $categories := slice }}
        {{ range .Site.Data.datasets }}
            {{ if not (in $categories .category) }}
                {{ $categories = $categories | append .category }}
            {{ end }}
        {{ end }}
        <select id="category-select" class="category-select">
            <option value="all">All Categories</option>
            {{ range $cat := sort $categories }}
            <option value="{{ $cat }}">{{ $cat }}</option>
            {{ end }}
        </select>

        <!-- View Toggle -->
        <div class="view-toggle">
            <button id="btn-cards" class="toggle-btn active">Cards</button>
            <button id="btn-table" class="toggle-btn">Table</button>
        </div>
    </div>

    <div id="result-count" class="result-count">{{ len .Site.Data.datasets }} datasets</div>

    <!-- Cards View -->
    <div id="cards-view" class="package-grid">
        {{ range $cat := $categories }}
        <div class="category-section" data-section-category="{{ $cat }}">
            <h2 class="category-title">{{ $cat }}</h2>
            <div class="cards-row">
                {{ range $.Site.Data.datasets }}
                {{ if eq .category $cat }}
                <div class="package-card dataset-card" data-aos="fade-up"
                     data-name="{{ .name | lower }}"
                     data-description="{{ .description | lower }}"
                     data-category="{{ .category }}"
                     data-tags="{{ delimit .tags "," | lower }}">
                    <div class="card-header">
                        {{ if .github_url }}
                        {{ $owner := replaceRE "https://github.com/([^/]+)/.*" "$1" .github_url }}
                        <img src="https://github.com/{{ $owner }}.png?size=64"
                             alt=""
                             class="package-logo"
                             loading="lazy"
                             onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 24 24%27 fill=%27%23666%27%3E%3Cpath d=%27M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z%27/%3E%3C/svg%3E'">
                        {{ end }}
                        <h3 class="package-name">
                            <a href="{{ .url }}" target="_blank" rel="noopener">{{ .name }}</a>
                        </h3>
                    </div>
                    <p class="package-desc">{{ .description }}</p>
                    {{ if .tags }}
                    <div class="tag-container">
                        {{ range .tags }}
                        <span class="use-case-tag" data-tag="{{ . }}">{{ . }}</span>
                        {{ end }}
                    </div>
                    {{ end }}
                    <div class="card-footer">
                        <span class="category-badge">{{ .category }}</span>
                        <div class="card-links">
                            {{ if .docs_url }}
                            <a href="{{ .docs_url }}" target="_blank" class="link-btn" title="Documentation">Docs</a>
                            {{ end }}
                            {{ if .github_url }}
                            <a href="{{ .github_url }}" target="_blank" class="link-btn" title="GitHub">GitHub</a>
                            {{ end }}
                            <a href="{{ .url }}" target="_blank" class="link-btn" title="Visit">Visit</a>
                        </div>
                    </div>
                </div>
                {{ end }}
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>

    <!-- No Results Message -->
    <div id="no-results" class="no-results" style="display: none;">
        <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
        </svg>
        <p>No datasets found matching "<span id="search-term"></span>"</p>
        <button id="reset-filters" class="btn-reset">Clear filters</button>
    </div>

    <!-- Table View -->
    <div id="table-view" class="package-table-wrapper" style="display: none;">
        <table class="package-table">
            <thead>
                <tr>
                    <th>Dataset</th>
                    <th>Description</th>
                    <th>Category</th>
                    <th>Links</th>
                </tr>
            </thead>
            <tbody>
                {{ range .Site.Data.datasets }}
                <tr data-name="{{ .name | lower }}"
                    data-description="{{ .description | lower }}"
                    data-category="{{ .category }}"
                    data-tags="{{ delimit .tags "," | lower }}">
                    <td class="pkg-name">
                        <a href="{{ .url }}" target="_blank" rel="noopener">{{ .name }}</a>
                    </td>
                    <td class="pkg-desc">{{ .description }}</td>
                    <td class="pkg-cat"><span class="category-badge-sm">{{ .category }}</span></td>
                    <td class="pkg-links">
                        {{ if .docs_url }}<a href="{{ .docs_url }}" target="_blank">Docs</a>{{ end }}
                        {{ if and .docs_url .github_url }} | {{ end }}
                        {{ if .github_url }}<a href="{{ .github_url }}" target="_blank">GitHub</a>{{ end }}
                        {{ if or .docs_url .github_url }} | {{ end }}
                        <a href="{{ .url }}" target="_blank">Visit</a>
                    </td>
                </tr>
                {{ end }}
            </tbody>
        </table>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>Data sourced from <a href="https://github.com/rawatpranjal/industry-datasets" target="_blank">industry-datasets</a></p>
    </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize PageSearch with Fuse.js
    new PageSearch({
        searchInputId: 'dataset-search',
        cardSelector: '.package-card',
        tableRowSelector: '.package-table tbody tr',
        itemLabel: 'datasets',
        fuseKeys: [
            { name: 'name', weight: 2 },
            { name: 'tags', weight: 1.5 },
            { name: 'description', weight: 1 },
            { name: 'category', weight: 0.5 }
        ]
    });

    // Tag clicks (page-specific)
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('use-case-tag')) {
            var searchInput = document.getElementById('dataset-search');
            searchInput.value = e.target.dataset.tag;
            searchInput.dispatchEvent(new Event('input'));
        }
    });

    // View toggle (page-specific)
    const btnCards = document.getElementById('btn-cards');
    const btnTable = document.getElementById('btn-table');
    const cardsView = document.getElementById('cards-view');
    const tableView = document.getElementById('table-view');

    function setView(view) {
        if (view === 'table') {
            cardsView.style.display = 'none';
            tableView.style.display = '';
            btnCards.classList.remove('active');
            btnTable.classList.add('active');
        } else {
            cardsView.style.display = '';
            tableView.style.display = 'none';
            btnCards.classList.add('active');
            btnTable.classList.remove('active');
        }
        try { localStorage.setItem('datasetView', view); } catch(e) {}
    }

    btnCards.addEventListener('click', function() { setView('cards'); });
    btnTable.addEventListener('click', function() { setView('table'); });

    // Restore view preference
    try {
        const savedView = localStorage.getItem('datasetView');
        if (savedView) setView(savedView);
    } catch(e) {}
});
</script>
{{ end }}
