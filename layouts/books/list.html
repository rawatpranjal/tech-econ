{{ define "main" }}
<!-- Hero Section -->
<header class="hero hero-with-image hero-books">
    <h1 class="hero-title">Books</h1>
    <p class="hero-tagline">{{ len .Site.Data.books }} essential reads for tech economists.</p>
</header>

<!-- Search Index Data for Fuse.js -->
<script id="search-data" type="application/json">
[{{ range $i, $item := .Site.Data.books }}{{ if $i }},{{ end }}{"name":"{{ .name }}","description":"{{ .description | htmlEscape }}","category":"{{ .category }}","author":"{{ .author }}","year":"{{ .year }}"}{{ end }}]
</script>

<div class="container">
    <!-- Search and Filters Row -->
    <div class="search-filters-row">
        <!-- Search Bar -->
        <div class="search-container">
            <div class="search-input-wrapper">
                <svg class="search-icon" viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
                <input type="text"
                       id="book-search"
                       class="search-input"
                       placeholder="Search books..."
                       autocomplete="off">
                <button id="clear-search" class="clear-btn" type="button" aria-label="Clear search">
                    <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Category Dropdown -->
        {{ $categoryOrder := slice "Platform Economics" "AI & Machine Learning" "Advertising & Attention" "Pricing & Market Design" "Competition & Antitrust" "Labor & Gig Economy" }}
        <select id="category-select" class="category-select">
            <option value="all">All Categories</option>
            {{ range $cat := $categoryOrder }}
            <option value="{{ $cat }}">{{ $cat }}</option>
            {{ end }}
        </select>
    </div>

    <div id="result-count" class="result-count">{{ len .Site.Data.books }} books</div>

    <!-- Books Grid -->
    <div id="books-view" class="resources-grid">
        {{ range $cat := $categoryOrder }}
        <div class="category-section" data-section-category="{{ $cat }}">
            <h2 class="category-title">{{ $cat }}</h2>
            <div class="cards-row">
                {{ range $.Site.Data.books }}
                {{ if eq .category $cat }}
                <div class="resource-card" data-aos="fade-up"
                     data-name="{{ .name | lower }}"
                     data-description="{{ .description | lower }}"
                     data-category="{{ .category }}"
                     data-author="{{ .author | lower }}">
                    <div class="card-header">
                        <img class="resource-favicon"
                             src="https://www.google.com/s2/favicons?domain=amazon.com&sz=32"
                             alt=""
                             loading="lazy">
                        <h3 class="resource-name">
                            <a href="{{ .url }}" target="_blank" rel="noopener">{{ .name }}</a>
                        </h3>
                        <span class="resource-type">{{ .year }}</span>
                    </div>
                    <p class="resource-author">{{ .author }}</p>
                    <p class="resource-desc">{{ .description }}</p>
                    <div class="card-footer">
                        <span class="category-badge">{{ .category }}</span>
                        <a href="{{ .url }}" target="_blank" class="link-btn">Amazon</a>
                    </div>
                </div>
                {{ end }}
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>Essential reading for tech economists</p>
    </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    new PageSearch({
        searchInputId: 'book-search',
        cardSelector: '.resource-card',
        sectionSelector: '.category-section',
        itemLabel: 'books',
        fuseKeys: [
            { name: 'name', weight: 2 },
            { name: 'author', weight: 1.5 },
            { name: 'description', weight: 1 },
            { name: 'category', weight: 0.5 }
        ]
    });
});
</script>
{{ end }}
